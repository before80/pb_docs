+++
title = "跨版本运行时保证"
weight = 930
description = "该语言对跨版本运行时兼容性的保证。"
type = "docs"

+++

## Cross-Version Runtime Guarantee 跨版本运行时保证

The guarantees that the language has for cross-version runtime compatibility.

​	该语言对跨版本运行时兼容性的保证。



Protobuf language bindings have two components. The generated code (typically produced from `protoc`) and the runtime libraries that must be included when using the generated code. When these come from different releases of protobuf, we are in a “cross version runtime” situation.

​	Protobuf 语言绑定有两个组件。生成的代码（通常由 `protoc` 生成）和使用生成的代码时必须包含的运行时库。当这些组件来自不同的 protobuf 版本时，我们便处于“跨版本运行时”情况。

Historically, protobuf has not documented its cross-version runtime compatibility guarantees and has been inconsistent about enforcing what guarantees it provides. Moving forward, we intend to offer the following guarantees across all languages except C++. These are the default guarantees; however, owners of protobuf code generators and runtimes may explicitly override them with more specific guarantees for that language.

​	从历史上看，protobuf 并未记录其跨版本运行时兼容性保证，并且在强制执行其提供的保证方面一直不一致。展望未来，我们打算对除 C++ 之外的所有语言提供以下保证。这些是默认保证；但是，protobuf 代码生成器和运行时的所有者可以明确地用针对该语言的更具体保证来覆盖它们。

## 主要版本 Major Versions 

Protobuf will not support mixing generated code and runtimes across major version boundaries. We will add “poison pills” where possible to detect these mismatches.
Protobuf 不支持跨主要版本边界混合生成的代码和运行时。我们将在可能的情况下添加“毒丸”来检测这些不匹配的情况。

## 次要版本 Minor Versions 

Within a single major runtime version, generated code from an older version of `protoc` will run on a newer runtime.

​	在单个主要运行时版本内，从旧版 `protoc` 生成的代码将在较新的运行时上运行。

Within a single major runtime version, generated code from a newer version of `protoc` is not guaranteed to run on an older runtime. We will add “poison pills” where possible to detect these mismatches.

​	在单个主要运行时版本内，无法保证从较新版 `protoc` 生成的代码在较旧的运行时上运行。我们将尽可能添加“毒丸”来检测这些不匹配。

## 安全异常 Security Exception 

We reserve the right to violate the above promises if needed for security reasons. We expect these exceptions to be rare, but will always prioritize security above these guarantees. For example, [footmitten](https://cve.report/CVE-2022-3510) required paired updates to both the runtime and the generated code for Java. As a result, code generated by 3.20.3 (which contained the footmitten fix) would not load with runtime library 3.21.6 (which predates the footmitten fix), creating the following compatibility matrix:

​	如果出于安全原因需要，我们保留违反上述承诺的权利。我们预计这些异常情况很少见，但始终会将安全性置于这些保证之上。例如，footmitten 需要对 Java 的运行时和生成的代码进行配对更新。因此，由 3.20.3（其中包含 footmitten 修复程序）生成的代码将无法与运行时库 3.21.6（早于 footmitten 修复程序）一起加载，从而创建以下兼容性矩阵：

|                             | Generated Code Version 生成的代码版本 |                      |                        |                          |                   |
| --------------------------- | ------------------------------------- | -------------------- | ---------------------- | ------------------------ | ----------------- |
| 3.20.2                      | 3.20.3                                | 3.21.6               | 3.21.7                 |                          |                   |
| Runtime 运行时 Version 版本 | 3.20.2                                | Vuln 漏洞            | **Broken 已损坏**      | **Vuln 漏洞**            | **Broken 已损坏** |
| 3.20.3                      | Vuln 重试 错误原因                    | Works 重试 错误原因  | **Vuln 重试 错误原因** | **Works? 重试 错误原因** |                   |
| 3.21.6                      | Vuln 重试 错误原因                    | Broken 重试 错误原因 | Vuln 重试 错误原因     | **Broken 重试 错误原因** |                   |
| 3.21.7                      | Vuln 重试 错误原因                    | Works 重试 错误原因  | Vuln                   | Works                    |                   |

- “Vuln” indicates that the combination will successfully start, but the security vulnerability still exists.
- “Vuln”表示组合将成功启动，但安全漏洞仍然存在。
- “Works” indicates that the combination will successfully start and does not have the vulnerability.
- “Works”表示组合将成功启动且不存在漏洞。
- “Broken” indicates that the combination will not successfully start.
- “Broken”表示组合将不会成功启动。
- **Bold** indicates configurations that were never deliberately intended to function together given the guarantees outlined in this topic.
- 粗体表示根据本主题中概述的保证，从不打算一起运行的配置。

## 多个主要运行时版本不能共存 No Coexistence of Multiple Major Runtime Versions 

Coexistence of multiple major versions in the same process is **not** supported.

​	不支持在同一进程中同时存在多个主要版本。

## C++ 特定保证 C++ Specific Guarantees 

Protobuf C++ disclaims all cross-runtime support and requires an exact match between its generated code version and its runtime version at all times. Additionally, Protobuf C++ makes no guarantees about ABI stability across any releases (major, minor, or micro).

​	Protobuf C++ 不支持跨运行时支持，并且始终要求其生成的代码版本与其运行时版本完全匹配。此外，Protobuf C++ 不保证任何版本（主要版本、次要版本或微版本）的 ABI 稳定性。
